<div style="max-width: 700px; margin: auto; font-family: sans-serif;">

  <div style="text-align: right; margin-bottom: 10px;">
    <%= button_to "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ", destroy_user_session_path, method: :delete, form: { data: { turbo: false } } %>
  </div>

  <h1>ğŸƒâ€â™€ï¸ ä»Šæ—¥ã®é‹å‹•è¨˜éŒ²</h1>

  <%= form_with model: @exercise, local: true do |f| %>
    <div>
      <%= f.label :name, "é‹å‹•å" %><br>
      <%= f.text_field :name %>
    </div>

    <div>
      <%= f.label :duration, "æ™‚é–“ï¼ˆåˆ†ï¼‰" %><br>
      <%= f.number_field :duration %>
    </div>

    <div>
      <%= f.label :exercised_on, "æ—¥ä»˜" %><br>
      <%= f.date_field :exercised_on, value: Date.today %>
    </div>

    <div style="margin-top: 10px;">
      <%= f.submit "è¨˜éŒ²ã™ã‚‹" %>
    </div>
  <% end %>

  <hr>

  <hr>

<h2>ğŸ“‹ è¨˜éŒ²ä¸€è¦§ï¼ˆæ—¥ä»˜ã”ã¨ï¼‰</h2>

<% @exercises.group_by(&:exercised_on).each do |date, exercises| %>
  <% total_minutes = exercises.sum(&:duration) %>

  <div style="margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; border-radius: 8px;">
    <h3 style="cursor: pointer;" onclick="toggleDay('<%= date %>')">
      ğŸ“… <%= date %>ã€€
      ğŸ•’ åˆè¨ˆ: <%= total_minutes %> åˆ†
      <span id="icon-<%= date %>">â–¼</span>
    </h3>

    <div id="day-<%= date %>">
      <table border="1" cellpadding="5" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th>é‹å‹•å</th>
            <th>æ™‚é–“ï¼ˆåˆ†ï¼‰</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <% exercises.each do |exercise| %>
            <tr>
              <td><%= exercise.name %></td>
              <td><%= exercise.duration %></td>
              <td>
                <%= link_to "ç·¨é›†", edit_exercise_path(exercise) %> |
                <%= link_to "å‰Šé™¤", exercise_path(exercise), method: :delete, data: { confirm: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<h2>ğŸ“Š é€±é–“é‹å‹•æ™‚é–“</h2>

<canvas id="exerciseChart" width="400" height="200"></canvas>

<script>
  document.addEventListener("turbo:load", function() {
    const ctx = document.getElementById("exerciseChart");
    if (!ctx) return;

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: <%= raw @graph_labels.to_json %>,
        datasets: [{
          label: "é‹å‹•æ™‚é–“ï¼ˆåˆ†ï¼‰",
          data: <%= raw @graph_data.to_json %>,
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  });
</script>


<script>
  function toggleDay(date) {
    const content = document.getElementById(`day-${date}`);
    const icon = document.getElementById(`icon-${date}`);
    if (content.style.display === "none") {
      content.style.display = "block";
      icon.textContent = "â–¼";
    } else {
      content.style.display = "none";
      icon.textContent = "â–¶";
    }
  }
</script>


    </tbody>
  </table>

</div>
